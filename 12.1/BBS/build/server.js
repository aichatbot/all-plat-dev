!function(e){var t={};function r(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(a,n,function(t){return e[t]}.bind(null,n));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=26)}([function(e,t){e.exports=require("react")},function(e,t){e.exports=require("react-bootstrap")},function(e,t){e.exports=require("@babel/runtime/regenerator")},function(e,t){e.exports=require("@babel/runtime/helpers/asyncToGenerator")},function(e,t){e.exports=require("@babel/runtime/helpers/slicedToArray")},function(e,t){e.exports=require("react-router-dom")},function(e,t){e.exports=require("mongoose")},function(e,t){e.exports=require("react-helmet")},function(e,t){e.exports=require("react-router-bootstrap")},function(e,t,r){"use strict";t.randomBytes=t.rng=t.pseudoRandomBytes=t.prng=r(15),t.createHash=t.Hash=r(16),t.createHmac=t.Hmac=r(17);var a=r(18),n=Object.keys(a),s=["sha1","sha224","sha256","sha384","sha512","md5","rmd160"].concat(n);t.getHashes=function(){return s};var c=r(19);t.pbkdf2=c.pbkdf2,t.pbkdf2Sync=c.pbkdf2Sync;var u=r(20);t.Cipher=u.Cipher,t.createCipher=u.createCipher,t.Cipheriv=u.Cipheriv,t.createCipheriv=u.createCipheriv,t.Decipher=u.Decipher,t.createDecipher=u.createDecipher,t.Decipheriv=u.Decipheriv,t.createDecipheriv=u.createDecipheriv,t.getCiphers=u.getCiphers,t.listCiphers=u.listCiphers;var o=r(21);t.DiffieHellmanGroup=o.DiffieHellmanGroup,t.createDiffieHellmanGroup=o.createDiffieHellmanGroup,t.getDiffieHellman=o.getDiffieHellman,t.createDiffieHellman=o.createDiffieHellman,t.DiffieHellman=o.DiffieHellman;var l=r(22);t.createSign=l.createSign,t.Sign=l.Sign,t.createVerify=l.createVerify,t.Verify=l.Verify,t.createECDH=r(23);var i=r(24);t.publicEncrypt=i.publicEncrypt,t.privateEncrypt=i.privateEncrypt,t.publicDecrypt=i.publicDecrypt,t.privateDecrypt=i.privateDecrypt;var m=r(25);t.randomFill=m.randomFill,t.randomFillSync=m.randomFillSync,t.createCredentials=function(){throw new Error(["sorry, createCredentials is not implemented yet","we accept pull requests","https://github.com/crypto-browserify/crypto-browserify"].join("\n"))},t.constants={DH_CHECK_P_NOT_SAFE_PRIME:2,DH_CHECK_P_NOT_PRIME:1,DH_UNABLE_TO_CHECK_GENERATOR:4,DH_NOT_SUITABLE_GENERATOR:8,NPN_ENABLED:1,ALPN_ENABLED:1,RSA_PKCS1_PADDING:1,RSA_SSLV23_PADDING:2,RSA_NO_PADDING:3,RSA_PKCS1_OAEP_PADDING:4,RSA_X931_PADDING:5,RSA_PKCS1_PSS_PADDING:6,POINT_CONVERSION_COMPRESSED:2,POINT_CONVERSION_UNCOMPRESSED:4,POINT_CONVERSION_HYBRID:6}},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("react-dom/server")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("uuid")},function(e,t){e.exports=require("multer")},function(e,t){e.exports=require("randombytes")},function(e,t){e.exports=require("create-hash")},function(e,t){e.exports=require("create-hmac")},function(e,t){e.exports=require("browserify-sign/algos")},function(e,t){e.exports=require("pbkdf2")},function(e,t){e.exports=require("browserify-cipher")},function(e,t){e.exports=require("diffie-hellman")},function(e,t){e.exports=require("browserify-sign")},function(e,t){e.exports=require("create-ecdh")},function(e,t){e.exports=require("public-encrypt")},function(e,t){e.exports=require("randomfill")},function(e,t,r){"use strict";r.r(t);var a=r(0),n=r.n(a),s=r(11),c=r.n(s),u=r(5),o=r(6),l=r.n(o),i=r(10),m=r.n(i),p=r(12),d=r.n(p),f=r(7),h=r(2),v=r.n(h),b=r(3),E=r.n(b),g=r(4),x=r.n(g),k=r(1),y=r(8),j="http://119.110.120.111",w=Object(u.withRouter)(function(e){var t=e.history,r=Object(a.useContext)(te),s=r.user,c=r.setUser,u=r.auth,o=r.setAuth,l=(i=E()(v.a.mark(function e(){var r,a,n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=JSON,e.next=4,localStorage.getItem("BBS");case 4:return e.t1=e.sent,r=e.t0.parse.call(e.t0,e.t1),e.next=8,fetch("".concat(j,":").concat(3e3,"/api/users/logout"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});case 8:return a=e.sent,e.next=11,a.json();case 11:n=e.sent,a.ok?(alert(n.message),o(!1),c({}),t.push("/")):alert(n.message),e.next=18;break;case 15:throw e.prev=15,e.t2=e.catch(0),e.t2;case 18:case"end":return e.stop()}},e,null,[[0,15]])})),function(){return i.apply(this,arguments)});var i;return n.a.createElement(k.Navbar,{bg:"primary",variant:"dark",expand:"lg"},n.a.createElement(k.Navbar.Brand,{href:"#"},"BBS"),n.a.createElement(k.Navbar.Toggle,{"aria-controls":"basic-navbar-nav"}),n.a.createElement(k.Navbar.Collapse,{id:"basic-navbar-nav"},n.a.createElement(k.Nav,{className:"mr-auto"},n.a.createElement(y.LinkContainer,{to:"/home/"},n.a.createElement(k.Nav.Link,null,"首页")),n.a.createElement(y.LinkContainer,{to:"/threads/"},n.a.createElement(k.Nav.Link,null,"帖子")),u?n.a.createElement(k.NavDropdown,{title:"个人中心",id:"basic-nav-dropdown"},n.a.createElement(y.LinkContainer,{to:"/profile/".concat(s.username)},n.a.createElement(k.NavDropdown.Item,{href:"#"},"个人信息")),n.a.createElement(y.LinkContainer,{to:"/setting/"},n.a.createElement(k.NavDropdown.Item,{href:"#"},"修改信息"))):null),n.a.createElement("div",{className:"ml-auto"},u?n.a.createElement(function(){return n.a.createElement("div",null,n.a.createElement("img",{src:s.avatar?"/upload/".concat(s.avatar):"/img/avatar.png",alt:"头像",width:32,height:32,className:"rounded"}),n.a.createElement("span",{style:{color:"white"},onClick:function(){return l()}},"  退出"))},null):null)))}),S=function(){return n.a.createElement("footer",{className:"mt-3"},n.a.createElement("center",null,"Copyright © 2019 xxBBs",n.a.createElement("br",null),"All Rights Reserved"))},C=function(){return n.a.createElement(k.Carousel,null,n.a.createElement(k.Carousel.Item,null,n.a.createElement("img",{className:"d-block w-100",src:"/img/demo1.jpeg",alt:"First slide"}),n.a.createElement(k.Carousel.Caption,null,n.a.createElement("h3",null,"夕阳"),n.a.createElement("p",null,"一同欣赏美景"))),n.a.createElement(k.Carousel.Item,null,n.a.createElement("img",{className:"d-block w-100",src:"/img/demo2.jpeg",alt:"Third slide"}),n.a.createElement(k.Carousel.Caption,null,n.a.createElement("h3",null,"白云"),n.a.createElement("p",null,"一同欣赏美景"))),n.a.createElement(k.Carousel.Item,null,n.a.createElement("img",{className:"d-block w-100",src:"/img/demo3.jpeg",alt:"Third slide"}),n.a.createElement(k.Carousel.Caption,null,n.a.createElement("h3",null,"海滨"),n.a.createElement("p",null,"一同欣赏美景"))))},O=function(){return n.a.createElement(k.Jumbotron,{className:"flex-fill m-0"},n.a.createElement("h1",null,"xxBBS"),n.a.createElement("p",null,"欢迎来到xxBBS系统。",n.a.createElement("br",null),"请畅所欲言！"))},N=function(){var e=Object(a.useContext)(te).setAuth,t=(c=E()(v.a.mark(function t(r){var a,n,s;return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch("".concat(j,":").concat(3e3,"/api/users/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});case 3:return a=t.sent,t.next=6,a.json();case 6:if(n=t.sent,!a.ok){t.next=16;break}return alert(n.message),s={username:n.data.username,token:n.data.token},t.next=12,localStorage.setItem(DOMAIN,JSON.stringify(s));case 12:e(!0),setUser({username:n.data.username}),t.next=17;break;case 16:alert(n.message);case 17:t.next=22;break;case 19:throw t.prev=19,t.t0=t.catch(0),t.t0.message;case 22:case"end":return t.stop()}},t,null,[[0,19]])})),function(e){return c.apply(this,arguments)}),r=(s=E()(v.a.mark(function e(r){var a,n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat(j,":").concat(3e3,"/api/users"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});case 3:return a=e.sent,e.next=6,a.json();case 6:n=e.sent,a.ok?(alert(n.message),t(r)):alert(n.message),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),alert(e.t0.message);case 13:case"end":return e.stop()}},e,null,[[0,10]])})),function(e){return s.apply(this,arguments)});var s;var c;return n.a.createElement(k.Form,{id:"registerForm"},n.a.createElement(k.Form.Group,{controlId:"username"},n.a.createElement(k.Form.Label,null,"用户名"),n.a.createElement(k.Form.Control,{type:"text",placeholder:"请输入用户名"})),n.a.createElement(k.Form.Group,{controlId:"password"},n.a.createElement(k.Form.Label,null,"密码"),n.a.createElement(k.Form.Control,{type:"password",placeholder:"请输入密码"})),n.a.createElement(k.Form.Group,{controlId:"confirmpass"},n.a.createElement(k.Form.Label,null,"确认密码"),n.a.createElement(k.Form.Control,{type:"password",placeholder:"请再输入一遍密码"})),n.a.createElement(k.Button,{variant:"primary",type:"submit",onClick:function(e){return function(e){e.preventDefault();var t=document.forms.registerForm,a=t.username.value,n=t.password.value,s=t.confirmpass.value;r({username:a,password:n,confirmpass:s})}(e)}},"注册"))},T=function(){var e=Object(a.useContext)(te),t=e.setUser,r=e.setAuth,s=(c=E()(v.a.mark(function e(a){var n,s,c;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat(j,":").concat(3e3,"/api/users/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});case 3:return n=e.sent,e.next=6,n.json();case 6:if(s=e.sent,!n.ok){e.next=16;break}return alert(s.message),c={username:s.data.username,token:s.data.token},e.next=12,localStorage.setItem("BBS",JSON.stringify(c));case 12:r(!0),t({username:s.data.username}),e.next=17;break;case 16:alert(s.message);case 17:e.next=22;break;case 19:throw e.prev=19,e.t0=e.catch(0),e.t0.message;case 22:case"end":return e.stop()}},e,null,[[0,19]])})),function(e){return c.apply(this,arguments)});var c;return n.a.createElement(k.Form,{id:"loginForm"},n.a.createElement(k.Form.Group,{controlId:"username"},n.a.createElement(k.Form.Label,null,"用户名"),n.a.createElement(k.Form.Control,{type:"text",placeholder:"请输入用户名"})),n.a.createElement(k.Form.Group,{controlId:"password"},n.a.createElement(k.Form.Label,null,"密码"),n.a.createElement(k.Form.Control,{type:"password",placeholder:"请输入密码"})),n.a.createElement(k.Button,{variant:"primary",type:"submit",onClick:function(e){return function(e){e.preventDefault();var t=document.forms.loginForm,r=t.username.value,a=t.password.value;s({username:r,password:a})}(e)}},"登陆"))},D=function(){var e=Object(a.useState)("login"),t=x()(e,2),r=t[0],s=t[1];return n.a.createElement(k.Tabs,{id:"homeTabs",activeKey:r,onSelect:function(e){return s(e)}},n.a.createElement(k.Tab,{eventKey:"login",title:"登陆"},n.a.createElement(T,null)),n.a.createElement(k.Tab,{eventKey:"register",title:"注册"},n.a.createElement(N,null)))},F=function(){var e=Object(a.useContext)(te).auth;return n.a.createElement(k.Container,{fluid:!0},n.a.createElement(f.Helmet,{title:"首页"}),n.a.createElement(k.Row,null,n.a.createElement(k.Col,{sm:12,md:7,className:"pr-1"},n.a.createElement(C,null)),e?n.a.createElement(k.Col,{sm:12,md:5,className:"pl-0 d-flex align-items-stretch"},n.a.createElement(O,null)):n.a.createElement(k.Col,{sm:12,md:5,className:"pl-0"},n.a.createElement(D,null))))},I=function(){return n.a.createElement(k.Form,{id:"postForm"},n.a.createElement(k.Form.Group,{controlId:"title"},n.a.createElement(k.Form.Label,null,"标题"),n.a.createElement(k.Form.Control,{type:"text",placeholder:"请输入帖子标题"})),n.a.createElement(k.Form.Group,{controlId:"content"},n.a.createElement(k.Form.Label,null,"内容"),n.a.createElement(k.Form.Control,{as:"textarea",rows:"3"})))},B=function(e){var t=e.loadThreads,r=Object(a.useState)(!1),s=x()(r,2),c=s[0],u=s[1],o=function(){return u(!1)},l=(p=E()(v.a.mark(function e(r){var a,n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat(j,":").concat(3e3,"/api/threads"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});case 3:return a=e.sent,e.next=6,a.json();case 6:n=e.sent,a.ok?(alert(n.message),o(),t()):alert(n.message),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),alert(e.t0.message);case 13:case"end":return e.stop()}},e,null,[[0,10]])})),function(e){return p.apply(this,arguments)}),i=(m=E()(v.a.mark(function e(){var t,r,a,n,s,c;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,localStorage.getItem("BBS");case 3:e.t1=e.sent,t=e.t0.parse.call(e.t0,e.t1),r=t.username,a=t.token,n=document.forms.postForm,s=n.title.value,c=n.content.value,l({username:r,token:a,title:s,content:c});case 12:case"end":return e.stop()}},e)})),function(){return m.apply(this,arguments)});var m;var p;return n.a.createElement("div",null,n.a.createElement(k.Button,{variant:"outline-success",size:"sm",onClick:function(){return u(!0)}},"发布新帖"),n.a.createElement(k.Modal,{show:c,onHide:function(){return o()}},n.a.createElement(k.Modal.Header,{closeButton:!0},n.a.createElement(k.Modal.Title,null,"发布新帖")),n.a.createElement(k.Modal.Body,null,n.a.createElement(I,null)),n.a.createElement(k.Modal.Footer,null,n.a.createElement(k.Button,{variant:"secondary",onClick:function(){return o()}},"关闭"),n.a.createElement(k.Button,{variant:"primary",onClick:function(){return i()}},"提交"))))},_=function(e){var t=e.thread;return n.a.createElement("tr",null,n.a.createElement("td",null,n.a.createElement(u.Link,{to:"/threads/".concat(t._id)},t.title)),n.a.createElement("td",null,t.author.username),n.a.createElement("td",null,new Date(t.posttime).toLocaleString()))},H=function(e){var t=e.loadThreads,r=e.threads;Object(a.useEffect)(function(){t()},[]);var s=r.map(function(e,t){return n.a.createElement(_,{key:t,thread:e})});return n.a.createElement(k.Table,{striped:!0,bordered:!0,hover:!0},n.a.createElement("thead",null,n.a.createElement("tr",null,n.a.createElement("th",null,"标题"),n.a.createElement("th",null,"作者"),n.a.createElement("th",null,"发布时间"))),n.a.createElement("tbody",null,s))},P=function(e){var t=e.thread;return t.author?n.a.createElement(k.Media,{className:"rounded border p-3 mb-3 mt-0"},n.a.createElement(G,{author:t.author}),n.a.createElement(k.Media.Body,null,n.a.createElement(A,{floor:t}))):null},q=function(e){var t=e.comments.map(function(e,t){return n.a.createElement(R,{key:t,comment:e})});return n.a.createElement("div",null,t)},R=function(e){var t=e.comment;return n.a.createElement(k.Media,{className:"rounded border p-3 mb-3"},n.a.createElement(G,{author:t.author}),n.a.createElement(k.Media.Body,null,n.a.createElement(A,{floor:t})))},G=function(e){var t=e.author;return n.a.createElement("div",null,n.a.createElement("img",{width:64,height:64,className:"mr-3 img-thumbnail round",src:t.avatar?"/upload/".concat(t.avatar):"/img/avatar.png",alt:t.username}),n.a.createElement("br",null),n.a.createElement("center",null,t.username))},A=function(e){var t=e.floor;return n.a.createElement("div",null,n.a.createElement("h5",null,t.title),n.a.createElement("p",null,t.content),n.a.createElement("p",{className:"d-flex justify-content-end text-muted"},n.a.createElement("small",null,"发表于"," ",new Date(t.posttime).toLocaleString())),n.a.createElement("hr",null),n.a.createElement("p",{className:"d-flex justify-content-end m-0"},n.a.createElement("small",null,t.author.description)))},L=function(e){var t=e.thread,r=e.comments,s=e.loadThread;return Object(a.useEffect)(function(){s()},[]),n.a.createElement("div",null,n.a.createElement(P,{thread:t}),n.a.createElement(q,{comments:r}))},M=function(e){var t=e.tid,r=e.loadThread,a=(u=E()(v.a.mark(function e(a){var n,s;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat(j,":").concat(3e3,"/api/comments/").concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});case 3:return n=e.sent,e.next=6,n.json();case 6:s=e.sent,n.ok?(alert(s.message),r(),document.forms.replyForm.content.value=""):alert(s.message),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),alert(e.t0.message);case 13:case"end":return e.stop()}},e,null,[[0,10]])})),function(e){return u.apply(this,arguments)}),s=(c=E()(v.a.mark(function e(t){var r,n,s,c,u;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.t0=JSON,e.next=4,localStorage.getItem("BBS");case 4:e.t1=e.sent,r=e.t0.parse.call(e.t0,e.t1),n=r.username,s=r.token,c=document.forms.replyForm,u=c.content.value,a({username:n,token:s,content:u});case 12:case"end":return e.stop()}},e)})),function(e){return c.apply(this,arguments)});var c;var u;return n.a.createElement(k.Form,{id:"replyForm",className:"p-3"},n.a.createElement(k.Form.Group,{controlId:"content"},n.a.createElement(k.Form.Label,null,"回复"),n.a.createElement(k.Form.Control,{as:"textarea",rows:"3"})),n.a.createElement(k.Button,{variant:"primary",type:"submit",onClick:function(e){return s(e)}},"提交"))},J=function(e){var t=e.tid,r=Object(a.useState)([]),s=x()(r,2),c=s[0],u=s[1],o=Object(a.useState)([]),l=x()(o,2),i=l[0],m=l[1],p=function(){var e=E()(v.a.mark(function e(){var r,a;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat(j,":").concat(3e3,"/api/threads/").concat(t),{method:"GET"});case 3:return r=e.sent,e.next=6,r.json();case 6:a=e.sent,r.ok?(u(a.data.thread.title),m(a.data.thread.content)):alert(a.message),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),alert(e.t0.message);case 13:case"end":return e.stop()}},e,null,[[0,10]])}));return function(){return e.apply(this,arguments)}}();return Object(a.useEffect)(function(){p()},[]),n.a.createElement(k.Form,{id:"modifyForm"},n.a.createElement(k.Form.Group,{controlId:"title"},n.a.createElement(k.Form.Label,null,"标题"),n.a.createElement(k.Form.Control,{type:"text",placeholder:"请输入帖子标题",defaultValue:c})),n.a.createElement(k.Form.Group,{controlId:"content"},n.a.createElement(k.Form.Label,null,"内容"),n.a.createElement(k.Form.Control,{as:"textarea",rows:"3",defaultValue:i})))},U=function(e){var t=e.tid,r=e.loadThread,s=Object(a.useState)(!1),c=x()(s,2),u=c[0],o=c[1],l=function(){return o(!1)},i=(d=E()(v.a.mark(function e(a){var n,s;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat(j,":").concat(3e3,"/api/threads/").concat(t),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});case 3:return n=e.sent,e.next=6,n.json();case 6:s=e.sent,n.ok?(alert(s.message),l(),r()):alert(s.message),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),alert(e.t0.message);case 13:case"end":return e.stop()}},e,null,[[0,10]])})),function(e){return d.apply(this,arguments)}),m=(p=E()(v.a.mark(function e(){var t,r,a,n,s,c;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,localStorage.getItem("BBS");case 3:e.t1=e.sent,t=e.t0.parse.call(e.t0,e.t1),r=t.username,a=t.token,n=document.forms.modifyForm,s=n.title.value,c=n.content.value,i({username:r,token:a,title:s,content:c});case 12:case"end":return e.stop()}},e)})),function(){return p.apply(this,arguments)});var p;var d;return n.a.createElement("div",null,n.a.createElement(k.Button,{variant:"outline-warning",size:"sm",onClick:function(){return o(!0)}},"修改"),n.a.createElement(k.Modal,{show:u,onHide:function(){return l()}},n.a.createElement(k.Modal.Header,{closeButton:!0},n.a.createElement(k.Modal.Title,null,"修改帖子")),n.a.createElement(k.Modal.Body,null,n.a.createElement(J,{tid:t})),n.a.createElement(k.Modal.Footer,null,n.a.createElement(k.Button,{variant:"secondary",onClick:function(){return l()}},"关闭"),n.a.createElement(k.Button,{variant:"primary",onClick:function(){return m()}},"提交"))))},V=Object(u.withRouter)(function(e){var t=e.tid,r=e.history,a=(u=E()(v.a.mark(function e(a){var n,s;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat(j,":").concat(3e3,"/api/threads/").concat(t),{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});case 3:return n=e.sent,e.next=6,n.json();case 6:s=e.sent,n.ok?(alert(s.message),r.push("/threads")):alert(s.message),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),alert(e.t0.message);case 13:case"end":return e.stop()}},e,null,[[0,10]])})),function(e){return u.apply(this,arguments)}),s=(c=E()(v.a.mark(function e(){var r,n,s;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:confirm("确认删除该贴子吗？")&&(r=JSON.parse(localStorage.getItem("BBS")),n=r.username,s=r.token,a({username:n,token:s,tid:t}));case 1:case"end":return e.stop()}},e)})),function(){return c.apply(this,arguments)});var c;var u;return n.a.createElement(k.Button,{variant:"outline-danger",size:"sm",onClick:function(){return s()}},"删除")}),K=function(e){var t=Object(a.useContext)(te),r=t.user,s=t.auth,c=e.match.params.tid,u=Object(a.useState)({}),o=x()(u,2),l=o[0],i=o[1],m=Object(a.useState)([]),p=x()(m,2),d=p[0],h=p[1],b=(g=E()(v.a.mark(function e(){var t,r;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat(j,":").concat(3e3,"/api/threads/").concat(c));case 3:return t=e.sent,e.next=6,t.json();case 6:r=e.sent,t.ok?(i(r.data.thread),h(r.data.comments)):alert(r.message),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),alert(e.t0.message);case 13:case"end":return e.stop()}},e,null,[[0,10]])})),function(){return g.apply(this,arguments)});var g;return n.a.createElement(k.Container,null,n.a.createElement(f.Helmet,{title:l.title}),l.author&&r.username===l.author.username?n.a.createElement(k.Row,{className:"m-0"},n.a.createElement(k.ButtonGroup,{className:"ml-auto"},n.a.createElement(U,{tid:c,loadThread:b}),n.a.createElement(V,{tid:c}))):null,n.a.createElement(L,{tid:c,thread:l,comments:d,loadThread:b}),s?n.a.createElement(M,{tid:c,loadThread:b}):null)},z=function(){var e=Object(a.useState)([]),t=x()(e,2),r=t[0],s=t[1],c=Object(a.useContext)(te).auth,u=function(){var e=E()(v.a.mark(function e(){var t,r;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat(j,":").concat(3e3,"/api/threads"),{method:"GET"});case 3:return t=e.sent,e.next=6,t.json();case 6:r=e.sent,t.ok?s(r.data):alert(r.message),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),alert(e.t0.message);case 13:case"end":return e.stop()}},e,null,[[0,10]])}));return function(){return e.apply(this,arguments)}}();return n.a.createElement(k.Container,null,n.a.createElement(f.Helmet,{title:"帖子列表"}),c?n.a.createElement(B,{loadThreads:u}):null,n.a.createElement(H,{loadThreads:u,threads:r}))},Y=function(){return n.a.createElement(u.Switch,null,n.a.createElement(u.Route,{exact:!0,path:"/threads",component:z}),n.a.createElement(u.Route,{exact:!0,path:"/threads/:tid",component:K}))},X=function(e){var t=e.user;return n.a.createElement(k.Card,null,n.a.createElement(k.Card.Header,null,"个人信息"),n.a.createElement(k.Card.Img,{variant:"top",src:t.avatar?"/upload/".concat(t.avatar):"/img/avatar.png",className:"rounded img-thumbnail"}),n.a.createElement(k.Card.Body,null,n.a.createElement(k.Card.Title,null,"用户名"),n.a.createElement(k.Card.Text,null,t.username),n.a.createElement(k.Card.Title,null,"个人描述"),n.a.createElement(k.Card.Text,null,t.description)))},Q=function(e){var t=e.threads.map(function(e,t){return n.a.createElement(k.ListGroup.Item,{key:t,className:"d-flex justify-content-between"},n.a.createElement("span",null,e.title),n.a.createElement("small",{className:"text-muted"},new Date(e.posttime).toLocaleString()))});return n.a.createElement(k.Card,null,n.a.createElement(k.Card.Header,null,"发帖信息"),n.a.createElement(k.ListGroup,{variant:"flush"},t))},W=function(e){var t=e.username,r=Object(a.useState)({}),s=x()(r,2),c=s[0],u=s[1],o=Object(a.useState)([]),l=x()(o,2),i=l[0],m=l[1];return Object(a.useEffect)(function(){var e;(e=E()(v.a.mark(function e(){var r,a;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat(j,":").concat(3e3,"/api/users/").concat(t),{method:"GET"});case 3:return r=e.sent,e.next=6,r.json();case 6:a=e.sent,r.ok&&(u(a.data),m(a.data.threads)),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),alert(e.t0.message);case 13:case"end":return e.stop()}},e,null,[[0,10]])})),function(){return e.apply(this,arguments)})()},[]),n.a.createElement(k.Row,null,n.a.createElement(k.Col,{sm:12,md:4},n.a.createElement(X,{user:c})),n.a.createElement(k.Col,{sm:12,md:8},n.a.createElement(Q,{threads:i})))},Z=function(e){var t=e.match.params.username;return n.a.createElement(k.Container,null,n.a.createElement(f.Helmet,{title:"".concat(t,"的个人信息")}),n.a.createElement(W,{username:t}))},$=function(){var e=Object(a.useState)([]),t=x()(e,2),r=t[0],s=t[1],c=(u=E()(v.a.mark(function e(){var t,r,a,n,c;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,localStorage.getItem("BBS");case 3:return t=e.sent,r=JSON.parse(t),a=r.username,r.token,e.next=7,fetch("".concat(j,":").concat(3e3,"/api/users/").concat(a),{method:"GET"});case 7:return n=e.sent,e.next=10,n.json();case 10:c=e.sent,n.ok?s(c.data):alert(c.message),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),alert(e.t0.message);case 17:case"end":return e.stop()}},e,null,[[0,14]])})),function(){return u.apply(this,arguments)});var u;Object(a.useEffect)(function(){c()},[]);var o=(l=E()(v.a.mark(function e(t){var r,a,n,s,u,o,l;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=JSON,e.next=4,localStorage.getItem("BBS");case 4:return e.t1=e.sent,r=e.t0.parse.call(e.t0,e.t1),a=r.username,n=r.token,s=t.description,u=new FormData,e.next=12,u.append("username",a);case 12:return e.next=14,u.append("token",n);case 14:return e.next=16,u.append("description",s);case 16:return e.next=18,u.append("avatar",document.querySelector("#uploader").files[0]);case 18:return e.next=20,fetch("".concat(j,":").concat(3e3,"/api/users"),{method:"PATCH",body:u});case 20:return o=e.sent,e.next=23,o.json();case 23:l=e.sent,o.ok?(alert(l.message),c()):alert(l.message),e.next=30;break;case 27:e.prev=27,e.t2=e.catch(0),alert(e.t2.message);case 30:case"end":return e.stop()}},e,null,[[0,27]])})),function(e){return l.apply(this,arguments)});var l;return n.a.createElement(k.Form,{id:"settingForm"},n.a.createElement(k.Form.Group,{controlId:"description"},n.a.createElement(k.Form.Label,null,"个人描述"),n.a.createElement(k.Form.Control,{type:"text",placeholder:"请输入个人描述",defaultValue:r.description})),n.a.createElement(k.Form.Group,{controlId:"uploader"},n.a.createElement(k.Form.Label,null,"头像"),n.a.createElement("br",null),n.a.createElement("img",{src:r.avatar?"/upload/".concat(r.avatar):"/img/avatar.png",alt:"头像",className:"rounded img-thumbnail"}),n.a.createElement(k.Form.Control,{type:"file",placeholder:"请上传头像"})),n.a.createElement(k.Button,{variant:"primary",type:"submit",onClick:function(e){return function(e){e.preventDefault();var t=document.forms.settingForm.description.value;o({description:t})}(e)}},"确定"))},ee=function(){return n.a.createElement(k.Container,null,n.a.createElement(k.Row,{className:"d-flex justify-content-center"},n.a.createElement(k.Col,{sm:12,md:6},n.a.createElement($,null))))},te=Object(a.createContext)({user:{},setUser:function(){},auth:!1,setAuth:function(){}}),re=function(){var e=Object(a.useState)({}),t=x()(e,2),r=t[0],s=t[1],c=Object(a.useState)(!1),o=x()(c,2),l=o[0],i=o[1],m=(p=E()(v.a.mark(function e(){var t,r,a;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,JSON.parse(localStorage.getItem("BBS"));case 3:return t=e.sent,e.next=6,fetch("".concat(j,":").concat(3e3,"/api/users/auth"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});case 6:return r=e.sent,e.next=9,r.json();case 9:a=e.sent,r.ok?(s(a.data),i(!0)):alert(a.message),e.next=16;break;case 13:throw e.prev=13,e.t0=e.catch(0),e.t0;case 16:case"end":return e.stop()}},e,null,[[0,13]])})),function(){return p.apply(this,arguments)});var p;return Object(a.useEffect)(function(){m()},[]),n.a.createElement(te.Provider,{value:{user:r,setUser:s,auth:l,setAuth:i}},n.a.createElement(f.Helmet,{titleTemplate:"%s | xxBBS —— 连接你和我",meta:[{name:"charset",content:"utf-8"},{name:"description",content:"全世界最不为人所知的电子留言板"}]}),n.a.createElement(w,null),n.a.createElement(u.Switch,null,n.a.createElement(u.Route,{exact:!0,path:"/",component:F}),n.a.createElement(u.Route,{path:"/home",component:F}),n.a.createElement(u.Route,{path:"/threads",component:Y}),n.a.createElement(u.Route,{path:"/profile/:username",component:Z}),n.a.createElement(u.Route,{path:"/setting",component:ee})),n.a.createElement(S,null))},ae=r(9),ne=r.n(ae),se=r(13),ce=r.n(se),ue=r(14),oe=r.n(ue),le=new l.a.Schema({title:{type:String,required:!0,trim:!0},content:{type:String,required:!0,trim:!0},posttime:{type:Date,default:Date.now()},author:{type:l.a.SchemaTypes.ObjectId,required:!0,ref:"User"}}),ie=l.a.model("Thread",le),me=new l.a.Schema({username:{type:String,unique:!0,required:!0,trim:!0},password:{type:String,required:!0,trim:!0},avatar:String,description:{type:String,trim:!0},token:String,threads:[{type:l.a.SchemaTypes.ObjectId,ref:"Thread"}]}),pe=l.a.model("User",me),de=oe()({dest:"./static/upload"}),fe=function(e){e.get("/api/users",(u=E()(v.a.mark(function e(t,r){var a;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,pe.find();case 3:return a=e.sent,e.abrupt("return",r.json({data:a}));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",r.status(400).json({message:e.t0.message}));case 10:case"end":return e.stop()}},e,null,[[0,7]])})),function(e,t){return u.apply(this,arguments)})),e.post("/api/users",(c=E()(v.a.mark(function e(t,r){var a,n,s,c,u,o;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=t.body,n=a.username,s=a.password,c=a.confirmpass,n){e.next=4;break}return e.abrupt("return",r.status(400).json({message:"没有输入用户名"}));case 4:if(s){e.next=6;break}return e.abrupt("return",r.status(400).json({message:"没有输入密码"}));case 6:if(c){e.next=8;break}return e.abrupt("return",r.status(400).json({message:"没有输入确认密码"}));case 8:if(s===c){e.next=10;break}return e.abrupt("return",r.status(400).json({message:"密码与确认密码不一致",data:"confirmpass"}));case 10:return e.next=12,pe.findOne({username:n});case 12:if(!e.sent){e.next=15;break}return e.abrupt("return",r.status(400).json({message:"该用户名已被使用"}));case 15:return u=ne.a.createHash("sha1").update(s).digest("hex"),o=new pe({username:n,password:u}),e.next=20,o.save();case 20:return e.abrupt("return",r.json({message:"新增用户成功"}));case 23:return e.prev=23,e.t0=e.catch(0),e.abrupt("return",r.status(400).json({message:e.t0.message}));case 26:case"end":return e.stop()}},e,null,[[0,23]])})),function(e,t){return c.apply(this,arguments)})),e.post("/api/users/login",(s=E()(v.a.mark(function e(t,r){var a,n,s,c,u,o,l;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=t.body,n=a.username,s=a.password,n){e.next=4;break}return e.abrupt("return",r.status(400).json({message:"没有输入用户名"}));case 4:if(s){e.next=6;break}return e.abrupt("return",r.status(400).json({message:"没有输入密码"}));case 6:return c=ne.a.createHash("sha1").update(s).digest("hex"),e.next=9,pe.findOne({username:n});case 9:if(u=e.sent){e.next=12;break}return e.abrupt("return",r.status(400).json({message:"该用户不存在"}));case 12:if(u.password===c){e.next=14;break}return e.abrupt("return",r.status(400).json({message:"密码错误，请重新输入"}));case 14:return o=ce.a.v4(),l=ne.a.createHash("sha1").update(o).digest("hex"),u.token=l,e.next=19,u.save();case 19:return e.abrupt("return",r.json({message:"成功登陆",data:{username:u.username,token:u.token}}));case 22:return e.prev=22,e.t0=e.catch(0),e.abrupt("return",r.status(400).json({message:e.t0.message}));case 25:case"end":return e.stop()}},e,null,[[0,22]])})),function(e,t){return s.apply(this,arguments)})),e.post("/api/users/auth",(n=E()(v.a.mark(function e(t,r){var a,n,s,c;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=t.body,n=a.username,s=a.token,n){e.next=4;break}return e.abrupt("return",r.status(400).json({message:"没有输入用户名"}));case 4:if(s){e.next=6;break}return e.abrupt("return",r.status(400).json({message:"没有输入token"}));case 6:return e.next=8,pe.findOne({username:n,token:s});case 8:if(c=e.sent){e.next=11;break}return e.abrupt("return",r.status(400).json({message:"token已过期，请重新登陆"}));case 11:return c.password=null,c.token=null,e.abrupt("return",r.json({message:"成功验证",data:c}));case 16:return e.prev=16,e.t0=e.catch(0),e.abrupt("return",r.status(400).json({message:e.t0.message}));case 19:case"end":return e.stop()}},e,null,[[0,16]])})),function(e,t){return n.apply(this,arguments)})),e.post("/api/users/logout",(a=E()(v.a.mark(function e(t,r){var a,n,s,c;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=t.body,n=a.username,s=a.token,n){e.next=4;break}return e.abrupt("return",r.status(400).json({message:"没有输入用户名"}));case 4:if(s){e.next=6;break}return e.abrupt("return",r.status(400).json({message:"没有输入token"}));case 6:return e.next=8,pe.findOne({username:n,token:s});case 8:if(c=e.sent){e.next=11;break}return e.abrupt("return",r.status(400).json({message:"token已过期，请重新登陆"}));case 11:return c.token=null,e.next=14,c.save();case 14:return e.abrupt("return",r.json({message:"退出成功"}));case 17:return e.prev=17,e.t0=e.catch(0),e.abrupt("return",r.status(400).json({message:e.t0.message}));case 20:case"end":return e.stop()}},e,null,[[0,17]])})),function(e,t){return a.apply(this,arguments)})),e.patch("/api/users",de.single("avatar"),(r=E()(v.a.mark(function e(t,r){var a,n,s,c,u;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=t.body,n=a.username,s=a.token,c=a.description,n){e.next=4;break}return e.abrupt("return",r.status(400).json({message:"没有输入用户名"}));case 4:if(s){e.next=6;break}return e.abrupt("return",r.status(400).json({message:"没有输入token"}));case 6:return e.next=8,pe.findOne({username:n,token:s});case 8:if(u=e.sent){e.next=11;break}return e.abrupt("return",r.status(400).json({message:"token已过期，请重新登陆"}));case 11:return t.file&&(u.avatar=t.file.filename),u.description=c,e.next=15,u.save();case 15:return e.abrupt("return",r.json({message:"修改用户资料成功"}));case 18:return e.prev=18,e.t0=e.catch(0),e.abrupt("return",r.status(400).json({message:e.t0.message}));case 21:case"end":return e.stop()}},e,null,[[0,18]])})),function(e,t){return r.apply(this,arguments)})),e.get("/api/users/:username",(t=E()(v.a.mark(function e(t,r){var a,n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=t.params.username){e.next=4;break}return e.abrupt("return",r.status(400).json({message:"没有输入用户名"}));case 4:return e.next=6,pe.findOne({username:a}).populate("threads","title posttime");case 6:if(n=e.sent){e.next=9;break}return e.abrupt("return",r.status(400).json({message:"该用户不存在"}));case 9:return n.password=null,n.token=null,e.abrupt("return",r.json({data:n}));case 14:return e.prev=14,e.t0=e.catch(0),e.abrupt("return",r.status(400).json({message:e.t0.message}));case 17:case"end":return e.stop()}},e,null,[[0,14]])})),function(e,r){return t.apply(this,arguments)}));var t;var r;var a;var n;var s;var c;var u},he=new l.a.Schema({content:{type:String,required:!0,trim:!0},posttime:{type:Date,default:Date.now()},author:{type:l.a.SchemaTypes.ObjectId,required:!0,ref:"User"},target:{type:l.a.SchemaTypes.ObjectId,required:!0,ref:"Thread"}}),ve=l.a.model("Comment",he),be=function(e){e.post("/api/threads",(c=E()(v.a.mark(function e(t,r){var a,n,s,c,u,o,l;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=t.body,n=a.username,s=a.token,c=a.title,u=a.content,n){e.next=4;break}return e.abrupt("return",r.status(400).json({message:"没有获取到用户名"}));case 4:if(s){e.next=6;break}return e.abrupt("return",r.status(400).json({message:"没有获取到身份凭证"}));case 6:if(c){e.next=8;break}return e.abrupt("return",r.status(400).json({message:"没有输入帖子标题"}));case 8:if(u){e.next=10;break}return e.abrupt("return",r.status(400).json({message:"没有输入帖子内容"}));case 10:return e.next=12,pe.findOne({username:n,token:s});case 12:if(o=e.sent){e.next=15;break}return e.abrupt("return",r.status(400).json({message:"token已过期，请重新登陆"}));case 15:return l=new ie({title:c,content:u,author:o}),e.next=19,l.save();case 19:return o.threads.push(l),e.next=22,o.save();case 22:return e.abrupt("return",r.json({message:"新增帖子成功"}));case 25:return e.prev=25,e.t0=e.catch(0),e.abrupt("return",r.status(400).json({message:e.t0.message}));case 28:case"end":return e.stop()}},e,null,[[0,25]])})),function(e,t){return c.apply(this,arguments)})),e.post("/api/comments/:tid",(s=E()(v.a.mark(function e(t,r){var a,n,s,c,u,o,l;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=t.params.tid,n=t.body,s=n.username,c=n.token,u=n.content,a){e.next=5;break}return e.abrupt("return",r.status(400).json({message:"没有输入帖子ID"}));case 5:if(s){e.next=7;break}return e.abrupt("return",r.status(400).json({message:"没有输入用户名"}));case 7:if(c){e.next=9;break}return e.abrupt("return",r.status(400).json({message:"没有输入身份凭证"}));case 9:if(u){e.next=11;break}return e.abrupt("return",r.status(400).json({message:"没有输入回复内容"}));case 11:return e.next=13,pe.findOne({username:s,token:c});case 13:if(o=e.sent){e.next=16;break}return e.abrupt("return",r.status(400).json({message:"token已过期，请重新登陆"}));case 16:return e.next=18,ie.findById(a);case 18:if(e.sent){e.next=21;break}return e.abrupt("return",r.status(400).json({message:"该帖子不存在"}));case 21:return l=new ve({content:u,author:o,target:a}),e.next=25,l.save();case 25:return e.abrupt("return",r.json({message:"新增回复成功"}));case 28:return e.prev=28,e.t0=e.catch(0),e.abrupt("return",r.status(400).json({message:e.t0.message}));case 31:case"end":return e.stop()}},e,null,[[0,28]])})),function(e,t){return s.apply(this,arguments)})),e.get("/api/threads",(n=E()(v.a.mark(function e(t,r){var a;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ie.find().populate("author","username avatar");case 3:return a=e.sent,e.abrupt("return",r.json({data:a}));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",r.status(400).json({message:e.t0.message}));case 10:case"end":return e.stop()}},e,null,[[0,7]])})),function(e,t){return n.apply(this,arguments)})),e.get("/api/threads/:tid",(a=E()(v.a.mark(function e(t,r){var a,n,s;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=t.params.tid){e.next=4;break}return e.abrupt("return",r.status(400).json({message:"没有输入帖子ID"}));case 4:return e.next=6,ie.findById(a).populate("author","username description avatar");case 6:if(n=e.sent){e.next=9;break}return e.abrupt("return",r.status(400).json({message:"该帖子不存在"}));case 9:return e.next=11,ve.find({target:a}).populate("author","username avatar description");case 11:return s=e.sent,e.abrupt("return",r.json({data:{thread:n,comments:s}}));case 15:return e.prev=15,e.t0=e.catch(0),e.abrupt("return",r.status(400).json({message:e.t0.message}));case 18:case"end":return e.stop()}},e,null,[[0,15]])})),function(e,t){return a.apply(this,arguments)})),e.patch("/api/threads/:tid",(r=E()(v.a.mark(function e(t,r){var a,n,s,c,u,o,l,i;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=t.params.tid,n=t.body,s=n.username,c=n.token,u=n.title,o=n.content,a){e.next=5;break}return e.abrupt("return",r.status(400).json({message:"没有获取到帖子ID"}));case 5:if(s){e.next=7;break}return e.abrupt("return",r.status(400).json({message:"没有获取到用户名"}));case 7:if(c){e.next=9;break}return e.abrupt("return",r.status(400).json({message:"没有输入token"}));case 9:if(u){e.next=11;break}return e.abrupt("return",r.status(400).json({message:"没有输入修改标题"}));case 11:if(o){e.next=13;break}return e.abrupt("return",r.status(400).json({message:"没有输入修改内容"}));case 13:return e.next=15,pe.findOne({username:s,token:c});case 15:if(l=e.sent){e.next=18;break}return e.abrupt("return",r.status(400).json({message:"token已过期，请重新登陆"}));case 18:return e.next=20,ie.findById(a);case 20:if(i=e.sent){e.next=23;break}return e.abrupt("return",r.status(400).json({message:"该帖子不存在"}));case 23:if(String(l._id)===String(i.author)){e.next=25;break}return e.abrupt("return",r.status(400).json({message:"你不是该贴的作者"}));case 25:return i.title=u,i.content=o,e.next=29,i.save();case 29:return e.abrupt("return",r.json({message:"修改帖子内容成功"}));case 32:return e.prev=32,e.t0=e.catch(0),e.abrupt("return",r.status(400).json({message:e.t0.message}));case 35:case"end":return e.stop()}},e,null,[[0,32]])})),function(e,t){return r.apply(this,arguments)})),e.delete("/api/threads/:tid",(t=E()(v.a.mark(function e(t,r){var a,n,s,c,u,o;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=t.params.tid){e.next=4;break}return e.abrupt("return",r.status(400).json({message:"没有输入帖子ID"}));case 4:if(n=t.body,s=n.username,c=n.token,s){e.next=7;break}return e.abrupt("return",r.status(400).json({message:"没有获取到用户名"}));case 7:if(c){e.next=9;break}return e.abrupt("return",r.status(400).json({message:"没有获取到token"}));case 9:return e.next=11,pe.findOne({username:s,token:c});case 11:if(u=e.sent){e.next=14;break}return e.abrupt("return",r.status(400).json({message:"token已过期，请重新登陆"}));case 14:return e.next=16,ie.findById(a);case 16:if(o=e.sent){e.next=19;break}return e.abrupt("return",r.status(400).json({message:"该帖子不存在"}));case 19:if(String(u._id)===String(o.author)){e.next=21;break}return e.abrupt("return",r.status(400).json({message:"你不是该贴的作者"}));case 21:return e.next=23,ve.deleteMany({target:l.a.Types.ObjectId(a)});case 23:return u.threads.pull(o),e.next=26,u.save();case 26:return e.next=28,o.remove();case 28:return e.abrupt("return",r.json({message:"删除帖子成功"}));case 31:return e.prev=31,e.t0=e.catch(0),e.abrupt("return",r.status(400).json({message:e.t0.message}));case 34:case"end":return e.stop()}},e,null,[[0,31]])})),function(e,r){return t.apply(this,arguments)}));var t;var r;var a;var n;var s;var c},Ee=function(e,t,r){var a=c.a.renderToString(n.a.createElement(u.StaticRouter,{location:e.url,context:{}},n.a.createElement(re,null))),s=f.Helmet.renderStatic();t.status(200).send(function(e,t){return"<!DOCTYPE html>\n    <html>\n      <head>\n        ".concat(t.meta.toString(),"\n        ").concat(t.title.toString(),'\n        <link rel="stylesheet" href="/css/bootstrap.min.css"/>\n      </head>\n      <body>\n        <div id="root">').concat(e,'</div>\n        <script src="/client.js" async><\/script>\n      </body>\n    </html>')}(a,s)),r()};l.a.connect("mongodb://localhost:27017/bbs",{useNewUrlParser:!0,useCreateIndex:!0},function(e){if(e)throw e;console.log("已连接到数据库...");var t=m()();t.use(d.a.json()),t.use(m.a.static("static")),fe(t),be(t),t.use(Ee),t.listen(3e3)})}]);
//# sourceMappingURL=server.js.map